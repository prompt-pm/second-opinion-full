<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Opinion</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%);
            min-height: 100vh;
        }
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glass-input {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .glass-chip {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s ease;
        }
        .glass-chip:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        textarea::placeholder, input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        .drag-over {
            background: rgba(59, 130, 246, 0.2) !important;
            border-color: rgba(59, 130, 246, 0.5) !important;
        }
        .thought-bubble {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 0.75rem 1rem;
            display: inline-block;
            position: relative;
        }
        .spiral-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            margin: 2rem 0;
        }
        .spiral-row {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .spiral-connector {
            width: 2px;
            height: 1rem;
            background: rgba(255, 255, 255, 0.2);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        @keyframes growDown {
            from {
                height: 0;
                opacity: 0;
            }
            to {
                height: 1rem;
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
            }
            50% {
                box-shadow: 0 0 20px 4px rgba(59, 130, 246, 0.3);
            }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }

        .animate-fade-in {
            animation: fadeIn 0.6s ease-out forwards;
            opacity: 0;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .animate-grow-down {
            animation: growDown 0.3s ease-out forwards;
            opacity: 0;
        }

        /* Staggered delays for spiral */
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.3s; }
        .delay-3 { animation-delay: 0.5s; }
        .delay-4 { animation-delay: 0.7s; }
        .delay-5 { animation-delay: 0.9s; }
        .delay-6 { animation-delay: 1.1s; }
        .delay-7 { animation-delay: 1.3s; }
        .delay-8 { animation-delay: 1.5s; }
        .delay-9 { animation-delay: 1.7s; }
        .delay-10 { animation-delay: 1.9s; }
        .delay-11 { animation-delay: 2.1s; }
        .delay-12 { animation-delay: 2.3s; }

        /* Thought bubble hover effects */
        .thought-bubble {
            transition: all 0.3s ease;
        }

        .thought-bubble:hover {
            transform: scale(1.05) translateY(-2px);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* CTA button pulse */
        .btn-pulse {
            animation: pulse 2s ease-in-out infinite;
        }

        .btn-pulse:hover {
            animation: none;
            transform: scale(1.05);
            box-shadow: 0 0 20px 4px rgba(59, 130, 246, 0.4);
        }

        /* Glass card hover */
        .glass-card-animated {
            transition: all 0.3s ease;
        }

        .glass-card-animated:hover {
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        /* Input focus glow */
        .glass-input:focus {
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.15);
            transition: all 0.3s ease;
        }

        /* Value prop hover */
        .value-prop {
            transition: all 0.2s ease;
        }

        .value-prop:hover {
            transform: translateY(-2px);
            color: white;
        }
    </style>
</head>
<body class="text-white">
<div class="min-h-screen flex items-center justify-center p-4" x-data="app">

    <!-- Landing View -->
    <div x-show="view === 'landing'" class="w-full max-w-3xl">
        <div class="glass rounded-3xl p-8 md:p-10">
            <!-- Hero -->
            <h1 class="text-3xl md:text-4xl font-bold text-center mb-2 animate-fade-in-up">Still thinking about it?</h1>
            <p class="text-gray-400 text-center mb-8 animate-fade-in delay-1">(It's been 3 weeks.)</p>

            <!-- Anxiety Spiral -->
            <div class="spiral-container">
                <div class="spiral-row">
                    <div class="thought-bubble text-sm animate-fade-in-up delay-2 animate-float" style="animation-delay: 0.2s, 0s;">Should I take this job? ðŸ˜Ÿ</div>
                </div>
                <div class="spiral-connector animate-grow-down delay-3"></div>
                <div class="spiral-row">
                    <div class="thought-bubble text-sm ml-8 animate-fade-in-up delay-4 animate-float" style="animation-delay: 0.4s, 0.5s;">But what if I hate it? ðŸ˜°</div>
                </div>
                <div class="spiral-connector animate-grow-down delay-5"></div>
                <div class="spiral-row">
                    <div class="thought-bubble text-sm ml-16 animate-fade-in-up delay-6 animate-float" style="animation-delay: 0.6s, 1s;">What if I'm making a huge mistake? ðŸ˜¨</div>
                </div>
                <div class="spiral-connector animate-grow-down delay-7"></div>
                <div class="spiral-row">
                    <div class="thought-bubble text-sm ml-24 animate-fade-in-up delay-8 animate-float" style="animation-delay: 0.8s, 1.5s;">What if I regret this forever? ðŸ˜±</div>
                </div>
                <div class="spiral-connector animate-grow-down delay-9"></div>
                <div class="spiral-row">
                    <div class="thought-bubble text-sm ml-32 animate-fade-in-up delay-10 animate-float" style="animation-delay: 1s, 2s;">3 AM, still awake, still thinking... ðŸŒ™ðŸ’­</div>
                </div>
            </div>

            <!-- Relatable Copy -->
            <div class="text-gray-300 text-sm md:text-base space-y-1 my-8">
                <p class="animate-fade-in-up delay-11">You've made a pro/con list. Then another one.</p>
                <p class="animate-fade-in-up delay-11" style="animation-delay: 2.2s;">You've asked 8 friends. Got 9 different opinions.</p>
                <p class="animate-fade-in-up delay-12" style="animation-delay: 2.4s;">You've asked ChatGPT 47 times. Still no answer.</p>
            </div>

            <!-- CTA Box -->
            <div class="glass-card glass-card-animated rounded-2xl p-6 mb-8 animate-fade-in-up" style="animation-delay: 2.6s;">
                <p class="font-semibold mb-1">Stop the spiral.</p>
                <p class="text-gray-400 text-sm mb-4">Get clarity in 20 minutes.</p>
                <div class="relative">
                    <textarea
                        x-model="input"
                        @keydown.enter.meta="submitInitial"
                        @keydown.enter.ctrl="submitInitial"
                        class="glass-input w-full rounded-2xl p-4 pr-16 text-white resize-none focus:outline-none min-h-[100px]"
                        placeholder="what's your situation?"
                        rows="3"
                    ></textarea>
                    <button
                        @click="submitInitial"
                        :disabled="!input.trim() || loading"
                        class="absolute bottom-4 right-4 bg-blue-500 hover:bg-blue-600 disabled:opacity-30 disabled:cursor-not-allowed text-white p-3 rounded-xl transition-all btn-pulse"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Value Props -->
            <div class="flex flex-wrap justify-center gap-6 text-sm md:text-base text-gray-300 animate-fade-in" style="animation-delay: 2.8s;">
                <span class="value-prop cursor-default">ðŸ¤” figure out what you want</span>
                <span class="value-prop cursor-default">âš¡ decide faster</span>
                <span class="value-prop cursor-default">âœ… take action</span>
            </div>
        </div>
    </div>

    <!-- Chat View -->
    <div x-show="view === 'chat'" class="w-full max-w-2xl">
        <div class="glass rounded-3xl p-6 md:p-8">
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold">Second Opinion</h2>
                <button @click="reset" class="text-gray-400 hover:text-white text-sm">New Chat</button>
            </div>

            <!-- Messages -->
            <div class="space-y-4 mb-6 max-h-[40vh] overflow-y-auto">
                <template x-for="(msg, i) in messages" :key="i">
                    <div :class="msg.role === 'user' ? 'ml-8' : 'mr-8'">
                        <div :class="msg.role === 'user' ? 'glass-card' : 'bg-transparent'" class="rounded-2xl p-4">
                            <p class="text-sm text-gray-300" x-text="msg.content"></p>
                        </div>
                    </div>
                </template>
                <div x-show="loading" class="text-gray-400 text-sm">Thinking...</div>
            </div>

            <!-- Priorities UI -->
            <div x-show="priorities.length > 0 && !prioritiesSubmitted" class="glass-card rounded-2xl p-5 mb-6">
                <h3 class="font-medium mb-3">Rank your priorities <span class="text-gray-400 text-sm">(drag to reorder)</span></h3>
                <ul class="space-y-2 mb-4">
                    <template x-for="(p, i) in priorities" :key="i">
                        <li draggable="true"
                            @dragstart="dragStart(i)"
                            @dragover.prevent="dragOver($event, i)"
                            @dragleave="dragLeave($event)"
                            @drop="drop($event, i)"
                            class="glass-chip rounded-xl p-3 cursor-move flex items-center text-sm group">
                            <span class="mr-3 text-gray-500">â‰¡</span>
                            <input
                                type="text"
                                x-model="priorities[i]"
                                class="flex-1 bg-transparent outline-none text-gray-200"
                                @click.stop
                            >
                            <button @click.stop="priorities.splice(i, 1)" class="ml-2 text-gray-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity">
                                âœ•
                            </button>
                        </li>
                    </template>
                </ul>
                <div class="flex gap-2 mb-4">
                    <input
                        type="text"
                        x-model="newPriority"
                        @keydown.enter="addPriority"
                        placeholder="Add a priority..."
                        class="glass-input flex-1 rounded-xl px-4 py-2 text-sm text-white focus:outline-none"
                    >
                    <button @click="addPriority" :disabled="!newPriority.trim()" class="bg-blue-500 hover:bg-blue-600 disabled:opacity-30 text-white px-4 py-2 rounded-xl text-sm transition-all">
                        Add
                    </button>
                </div>
                <button @click="submitPriorities" class="bg-green-500 hover:bg-green-600 text-white px-5 py-2 rounded-xl text-sm transition-all">
                    Confirm Ranking
                </button>
            </div>

            <!-- Input -->
            <div class="relative mb-4">
                <input
                    x-model="input"
                    @keydown.enter="sendMessage"
                    class="glass-input w-full rounded-xl p-4 pr-14 text-white focus:outline-none focus:border-blue-400/50"
                    placeholder="Type your message..."
                >
                <button
                    @click="sendMessage"
                    :disabled="!input.trim() || loading"
                    class="absolute right-2 top-1/2 -translate-y-1/2 bg-blue-500 hover:bg-blue-600 disabled:opacity-30 text-white p-2 rounded-lg transition-all"
                >
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                    </svg>
                </button>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3 flex-wrap">
                <button @click="getPriorities" :disabled="loading || messages.length === 0"
                    class="glass-chip rounded-xl px-4 py-2 text-sm disabled:opacity-30 disabled:cursor-not-allowed">
                    ðŸ“‹ Rank Priorities
                </button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('alpine:init', () => {
    Alpine.data('app', () => ({
        view: 'landing',
        messages: [],
        input: '',
        loading: false,
        priorities: [],
        prioritiesSubmitted: false,
        choices: [],
        choicesTitle: '',
        uncertainties: [],
        dragIndex: null,
        examples: [],
        newPriority: '',

        allExamples: [
            { emoji: 'ðŸ’¼', label: 'Should I take this job?', text: 'Should I take this job offer?' },
            { emoji: 'ðŸ’¼', label: 'Should I ask for a raise?', text: 'Should I ask my boss for a raise?' },
            { emoji: 'ðŸ’¼', label: 'Should I quit my job?', text: 'Should I quit my current job?' },
            { emoji: 'ðŸ’¼', label: 'Should I switch careers?', text: 'Should I switch to a different career?' },
            { emoji: 'ðŸ ', label: 'Should I move?', text: 'Should I move to a new city?' },
            { emoji: 'ðŸ ', label: 'Should I buy or rent?', text: 'Should I buy a place or keep renting?' },
            { emoji: 'ðŸ ', label: 'Should I get a roommate?', text: 'Should I get a roommate to save money?' },
            { emoji: 'â¤ï¸', label: 'Should I text them back?', text: 'Should I text them back?' },
            { emoji: 'â¤ï¸', label: 'Should I go on another date?', text: 'Should I go on another date with them?' },
            { emoji: 'â¤ï¸', label: 'Should I end this?', text: 'Should I end this relationship?' },
            { emoji: 'â¤ï¸', label: 'Should I say I love you?', text: 'Should I tell them I love them?' },
            { emoji: 'âœˆï¸', label: 'Where should I travel?', text: 'Where should I go on my next trip?' },
            { emoji: 'âœˆï¸', label: 'Should I book the trip?', text: 'Should I book this trip?' },
            { emoji: 'ðŸŽ“', label: 'Should I go back to school?', text: 'Should I go back to school?' },
            { emoji: 'ðŸ’°', label: 'Should I buy this?', text: 'Should I make this big purchase?' },
            { emoji: 'ðŸŽ¯', label: 'Should I start this project?', text: 'Should I start this side project?' },
        ],

        init() {
            this.examples = this.allExamples
                .sort(() => Math.random() - 0.5)
                .slice(0, 4);
        },

        useExample(text) {
            this.input = text;
        },

        async submitInitial() {
            if (!this.input.trim() || this.loading) return;
            this.messages.push({ role: 'user', content: this.input });
            this.view = 'chat';
            const userInput = this.input;
            this.input = '';
            this.loading = true;
            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: this.messages })
                });
                const data = await res.json();
                this.messages.push({ role: 'assistant', content: data.response });
            } catch (e) {
                this.messages.push({ role: 'assistant', content: 'Error: ' + e.message });
            }
            this.loading = false;
        },

        async sendMessage() {
            if (!this.input.trim() || this.loading) return;
            this.messages.push({ role: 'user', content: this.input });
            this.input = '';
            this.loading = true;
            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: this.messages })
                });
                const data = await res.json();
                this.messages.push({ role: 'assistant', content: data.response });
            } catch (e) {
                this.messages.push({ role: 'assistant', content: 'Error: ' + e.message });
            }
            this.loading = false;
        },

        async getPriorities() {
            this.loading = true;
            try {
                const res = await fetch('/api/priorities', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: this.messages })
                });
                const data = await res.json();
                this.priorities = data.priorities;
                this.prioritiesSubmitted = false;
            } catch (e) {
                alert('Error: ' + e.message);
            }
            this.loading = false;
        },

        async submitPriorities() {
            this.prioritiesSubmitted = true;
            this.messages.push({
                role: 'user',
                content: 'My priorities (ranked): ' + this.priorities.join(', ')
            });
            this.loading = true;
            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: this.messages })
                });
                const data = await res.json();
                this.messages.push({ role: 'assistant', content: data.response });
            } catch (e) {
                this.messages.push({ role: 'assistant', content: 'Error: ' + e.message });
            }
            this.loading = false;
        },

        addPriority() {
            if (this.newPriority.trim()) {
                this.priorities.push(this.newPriority.trim());
                this.newPriority = '';
            }
        },

        async getChoices() {
            this.loading = true;
            try {
                const res = await fetch('/api/choices', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: this.messages,
                        priorities: this.prioritiesSubmitted ? this.priorities : []
                    })
                });
                const data = await res.json();
                this.choices = data.choices;
                this.choicesTitle = data.title;
                this.uncertainties = data.uncertainties;
            } catch (e) {
                alert('Error: ' + e.message);
            }
            this.loading = false;
        },

        reset() {
            this.view = 'landing';
            this.messages = [];
            this.input = '';
            this.priorities = [];
            this.prioritiesSubmitted = false;
            this.newPriority = '';
            this.choices = [];
            this.choicesTitle = '';
            this.uncertainties = [];
        },

        dragStart(i) { this.dragIndex = i; },
        dragOver(e, i) { e.target.closest('li')?.classList.add('drag-over'); },
        dragLeave(e) { e.target.closest('li')?.classList.remove('drag-over'); },
        drop(e, i) {
            e.target.closest('li')?.classList.remove('drag-over');
            const item = this.priorities.splice(this.dragIndex, 1)[0];
            this.priorities.splice(i, 0, item);
            this.dragIndex = null;
        }
    }));
});
</script>
</body>
</html>
